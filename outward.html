<!-- outward.html -->

<div class="container">
  <img src="OLC.png" alt="ISTOS Medical Logo" class="logo" />
  <h1 class="inward-title">Outward Log</h1>

  <form id="outwardForm" action="YOUR_OUTWARD_ENDPOINT">
    <label>Item:
      <select name="item" required class="item-field">
        <option value="" disabled selected>Select item</option>
        <option value="Blades">Blades</option>
        <option value="Microtome Blades">Microtome Blades</option>
        <option value="Bonesaw Blades">Bonesaw Blades</option>
      </select>
    </label>

    <label>Quantity:
      <input type="number" name="quantity" required min="1" style="width: 80px;" />
    </label>

    <label>Destination:
      <input type="text" name="destination" required />
    </label>

    <div style="text-align: center;">
      <button type="submit" id="submitBtn">
        <span id="btnText">Submit</span>
        <span id="spinner" style="display: none; margin-left: 8px;">⏳</span>
      </button>
    </div>
  </form>

  <div id="toast">
    <span id="toastMessage">✅ Submitted successfully</span>
  </div>
</div>

<script>
const form = document.getElementById("outwardForm");
const submitBtn = document.getElementById("submitBtn");
const btnText = document.getElementById("btnText");
const spinner = document.getElementById("spinner");
const toast = document.getElementById("toast");
const toastMessage = document.getElementById("toastMessage");

form.addEventListener("submit", async function (event) {
  event.preventDefault();
  const quantity = parseInt(form.elements["quantity"].value, 10);
  const item = form.elements["item"].value;

  if (isNaN(quantity) || quantity <= 0) {
    showToast("❌ Quantity must be a positive number", "#c0392b");
    return;
  }

  // Fetch current balance from Google Sheets (via Apps Script endpoint)
  const balanceResponse = await fetch(`YOUR_BALANCE_ENDPOINT?item=${item}`);
  const balanceData = await balanceResponse.json();
  const currentBalance = balanceData.balance;

  if (quantity > currentBalance) {
    showToast(`❌ Only ${currentBalance} units available`, "#e74c3c");
    return;
  }

  // Proceed with submission
  submitBtn.disabled = true;
  btnText.textContent = "Submitting...";
  spinner.style.display = "inline";

  const formData = new FormData(form);
  const params = new URLSearchParams();
  for (const pair of formData.entries()) {
    params.append(pair[0], pair[1]);
  }

  fetch(form.action, {
    method: "POST",
    body: params
  })
    .then(response => response.text())
    .then(data => {
      showToast("✅ Outward entry submitted!", "#27ae60");
      resetFormAfterDelay(3000);
    })
    .catch(error => {
      showToast("❌ Submission failed", "#c0392b");
      submitBtn.disabled = false;
      btnText.textContent = "Submit";
      spinner.style.display = "none";
    });
});

function showToast(message, bgColor) {
  toastMessage.textContent = message;
  toast.style.backgroundColor = bgColor;
  toast.style.display = "block";
  toast.style.opacity = "1";
  setTimeout(() => {
    toast.style.opacity = "0";
    setTimeout(() => {
      toast.style.display = "none";
    }, 300);
  }, 3000);
}

function resetFormAfterDelay(delay) {
  setTimeout(() => {
    form.reset();
    submitBtn.disabled = false;
    btnText.textContent = "Submit";
    spinner.style.display = "none";
  }, delay);
}
</script>


